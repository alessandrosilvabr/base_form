<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Base form by andrerpbts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Base form</h1>
      <h2 class="project-tagline">A simple and small form objects Rails plugin for ActiveRecord based projects.</h2>
      <a href="https://github.com/andrerpbts/base_form" class="btn">View on GitHub</a>
      <a href="https://github.com/andrerpbts/base_form/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/andrerpbts/base_form/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="why" class="anchor" href="#why" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why?</h2>

<p>In a development day-to-day basis, we commonly are confronted with situations where we
need to save data in more than one database table, running it's own validations, and
the validations of the all context together. In most cases a Form Object is a perfect
solution to deliver those records in a fun and maintenable code.</p>

<p>Actually, there's a lot of another gems to do that, like the great
<a href="https://github.com/apotonick/reform">reform</a> or
<a href="https://github.com/GCorbel/activeform-rails">activeform-rails</a>, which are a more complete
solution for this problem. But, if you are looking for something lighter, maybe this
gem could fit well for you.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>base_form<span class="pl-pds">'</span></span></pre></div>

<p>And then execute:</p>

<div class="highlight highlight-source-shell"><pre>$ bundle</pre></div>

<p>Or install it yourself as:</p>

<div class="highlight highlight-source-shell"><pre>$ gem install base_form</pre></div>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>Let's suppose you want to create a
signup form (you can check this example in the dummy app on this gem specs), with
receiving a user email, a user password, a user password confirmation, and a plan. In your
signup form, you need to create an account for this user, associate it to a entrance plan
if it's not given, and make this user as an owner of this recently created account. Of course,
in this case, a simple user model saving will not be sufficient to save all those data and
accomplish with the requested business logic. So, you go to the Form Objects way,
installs this gem, creates your Ruby class to handle all this logic:</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">SignupForm<span class="pl-e"> &lt; BaseForm::Form</span></span>

<span class="pl-k">end</span></pre></div>

<p>With this empty class created, the easy way to start may be adding the attributes expected
in this form, like:</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">SignupForm<span class="pl-e"> &lt; BaseForm::Form</span></span>
  attribute <span class="pl-c1">:email</span>
  attribute <span class="pl-c1">:password</span>
  attribute <span class="pl-c1">:password_confirmation</span>
  attribute <span class="pl-c1">:plan</span>, <span class="pl-c1">Plan</span>, <span class="pl-c1">default:</span> proc { <span class="pl-c1">Plan</span>.default }
<span class="pl-k">end</span></pre></div>

<p>Note, if you don't specifies a Plan to this form, it will call a default value, which in
this case is calling a proc that will call a <code>default</code> method in <code>Plan</code> model and probably
this will return the default plan instance, fetched from the database or something like that.</p>

<p>Let's put some form specific validation here. For example, we don't want the Plan being forced
with an empty string for example:</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">SignupForm<span class="pl-e"> &lt; BaseForm::Form</span></span>
  <span class="pl-c"># ... attributes, validations ...</span>

  validates <span class="pl-c1">:plan</span>, <span class="pl-c1">presence:</span> <span class="pl-c1">true</span>
<span class="pl-k">end</span></pre></div>

<p>Now you may be asking: What about email and password? Shouldn't they be validated as well?
Well, you could, in fact, add all validations in this form instead put it in your models,
but sometimes you don't have much control of that.
Then, I'm showing here the case that <code>User</code> model has those validations. Don't be mad ok? :)</p>

<p>The form validations are the first validations tha are performed before it try to persist
something here. If this validation fails, for an example, the persist method will not even
be called, and we're done with it. Otherwise, it wil try to persist your logic, which we'll
implement next.</p>

<p>Ok, now, you need to set the records that you will persist here.
In this case is the <code>:user</code> you want to save, and the <code>:account</code> you will want to associate
to this user. So, you add it there (I recommend you let this in the top of the class to make
it clear):</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">SignupForm<span class="pl-e"> &lt; BaseForm::Form</span></span>
  use_form_records <span class="pl-c1">:user</span>, <span class="pl-c1">:account</span>

  <span class="pl-c"># ... attributes, validations ...</span>
<span class="pl-k">end</span></pre></div>

<p>This line will automatically generate <code>attr_readers</code> to each record there, and will add these
symbols in an array called <code>form_records</code> in your class. To understand it better, let's talk
about the <code>persist</code> implementation itself.</p>

<p>By the rule, the <code>persist</code> method is obligatory, and not implementing it, will cause your form
raise a <code>NotImplementedError</code> when calling <code>save</code> to it.</p>

<p>All things written inside <code>persist</code> method, will automatically run in a ActiveRecord transaction,
and if some record have its validation failed, this will perform a Rollback and deliver the form
to you with those erros grouped through <code>errors</code> method, like any AR model you are already
familiar with.</p>

<p>Let me stop to talk and show you something we can call as implementation of this:</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">SignupForm<span class="pl-e"> &lt; BaseForm::Form</span></span>
  <span class="pl-c"># form records, attributes, validations, whatever</span>

  <span class="pl-k">private</span> <span class="pl-c"># because isolation is still a necessary evil ;)</span>

  <span class="pl-k">def</span> <span class="pl-en">persist</span>
    <span class="pl-smi">@account</span> <span class="pl-k">||=</span> <span class="pl-c1">Account</span>.create <span class="pl-c1">plan:</span> plan
    <span class="pl-smi">@user</span> <span class="pl-k">||=</span> account.users.create user_params
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">user_params</span>
    {
      <span class="pl-c1">email:</span> email,
      <span class="pl-c1">password:</span> password,
      <span class="pl-c1">password_confirmation:</span> password_confirmation,
      <span class="pl-c1">account_owner:</span> <span class="pl-c1">true</span>
    }
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>So, here is the thing, see the variables names I've associated there, are the name os
form_records I've defined before. It tries to create an account, setting a plan to it
and then tries to create a user associated to this brand new account.</p>

<p>Is this <code>form_records</code> that will call each object associated here to check its errors,
and group it in <code>errors</code> object in your form itself in case of some validation brakes,
but if all is fine, the form instance is returned to you and you will be able to call
methods like <code>persisted?</code>, <code>account</code>, <code>user</code>, <code>valid?</code> and etc...</p>

<p>Are you still there? :D</p>

<p>Let's see this class complete?</p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">SignupForm<span class="pl-e"> &lt; BaseForm</span></span>
  use_form_records <span class="pl-c1">:account</span>, <span class="pl-c1">:user</span>

  attribute <span class="pl-c1">:email</span>
  attribute <span class="pl-c1">:password</span>
  attribute <span class="pl-c1">:password_confirmation</span>
  attribute <span class="pl-c1">:plan</span>, <span class="pl-c1">Plan</span>, <span class="pl-c1">default:</span> proc { <span class="pl-c1">Plan</span>.default }

  validates <span class="pl-c1">:plan</span>, <span class="pl-c1">presence:</span> <span class="pl-c1">true</span>

  <span class="pl-k">private</span>

  <span class="pl-k">def</span> <span class="pl-en">persist</span>
    <span class="pl-smi">@account</span> <span class="pl-k">||=</span> <span class="pl-c1">Account</span>.create <span class="pl-c1">plan:</span> plan
    <span class="pl-smi">@user</span> <span class="pl-k">||=</span> account.users.create user_params
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">user_params</span>
    {
      <span class="pl-c1">email:</span> email,
      <span class="pl-c1">password:</span> password,
      <span class="pl-c1">password_confirmation:</span> password_confirmation,
      <span class="pl-c1">account_owner:</span> <span class="pl-c1">true</span>
    }
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>Hmmmm, seems to be good enough. I hope this helps someone in the same way it
helped me. Thanks!</p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing</h2>

<ul>
<li>Fork it</li>
<li>Make your implementations</li>
<li>Send me a pull request</li>
</ul>

<p>Thank you!</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>The gem is available as open source under the terms of the <a href="http://opensource.org/licenses/MIT">MIT License</a>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/andrerpbts/base_form">Base form</a> is maintained by <a href="https://github.com/andrerpbts">andrerpbts</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
